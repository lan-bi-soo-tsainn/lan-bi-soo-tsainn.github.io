<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>市場</title>
    <link rel="stylesheet" href="css/detail.css">
    <script async src="https://unpkg.com/es-module-shims/dist/es-module-shims.js"></script>

    <script type="importmap">
	{
		"imports": {
			"three": "https://unpkg.com/three/build/three.module.js"
		}
	}
</script>
</head>

<body>
    <div class="music-block">
        <div class="arrow-btn">
            <img src="/assets/arrow-btn.png" />
        </div>
        <img class="detail-street-img" src="/assets/market/detail_market.png" />
        <div class="angle"></div>
        <audio id="music" controls src="/assets/market/market.mp3"></audio>
    </div>
    <article>
        <section class="video-block">
            <img class="video-block-background" src="/assets/background.png"
                srcset="/assets/background.png 500w, /assets/background.png 1000w, /assets/background.png 1500w" />
            <div class="video-block-intro">
                <div class="video-block-intro-content">
                    <h1>市場</h1>
                    <p>THE WARMTH<br />DEDICATED TO<br />THE EARLY<br />HOURS OF DAWN</p>
                </div>
                <div class="video-block-intro-3d">
                </div>
            </div>
            <div class="video-block-video-block">
                <video autoplay muted loop playsinline id="indexVideo">
                    <source src="/assets/market/market_intro.mp4" type="video/mp4">
                </video>
            </div>
        </section>
        <section class="article-block">
            <div class="article-block-word">
                <p>在這個繁忙的城市，市場承載著生活的起伏，<br>而在清晨的時光裡，它展現出一種凌晨限定的溫暖。</p>
                <p>夜未完全褪去，市場早已喚醒。<br>橙色的陽光透過市場的招牌，<br>輕輕灑在擺滿各色食材的攤位上。</p>
                <p>清新的空氣中彌漫著新鮮蔬果的香氣，<br>彷彿是一場大自然的綻放。</p>
                <p>攤販們早早來到這片熟悉的場所，<br>他們的笑容在晨光中顯得格外燦爛。</p>
                <p>老闆娘熱情地和顧客攀談<br>彼此間的交流讓整個市場充滿了溫馨和親切。</p>
            </div>
            <div class="article-block-word en">
                <p>In this bustling city, the market carries the ebb and flow of life, revealing a <br>
                    kind of dawn-limited warmth in the early morning.<br>
                    Before the night completely fades away, the market is already awake. The <br>
                    orange sunlight gently sprinkles through the market's signs, casting a soft <br>
                    glow on stalls filled with various ingredients. The fresh air is filled with the <br>
                    aroma of crisp fruits and vegetables, resembling a blossoming scene from <br>
                    nature.<br>
                    Vendors arrive early at this familiar place, their smiles shining brightly in the <br>
                    morning light. The market's proprietress engages warmly with customers, <br>
                    creating an atmosphere full of warmth and friendliness.</p>
            </div>
        </section>
        <div class="top-btn" data-action="gotop">
            <img src="/assets/btn.png" />
        </div>
    </article>

</body>
<script type="module" src="/js/3d_market.js"></script>
<script>
    var video = document.getElementById("indexVideo");
    function myFunction() {
        if (video.paused) {
            video.play();
        }
    }

    let requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;

    document.addEventListener('DOMContentLoaded', function () {
        const goTopButton = document.querySelector('[data-action="gotop"]');
        const windowViewPortHeight = window.innerHeight; // browser viewport height
        let isRequestingAnimationFrame = false;

        if (!goTopButton) {
            return;
        }

        goTopButton.addEventListener('click', function () {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    });

    document.addEventListener('DOMContentLoaded', function () {
        var aduioButton = document.querySelector('.arrow-btn');
        var music = document.getElementById("music");
        aduioButton.addEventListener('click', function () {
            if (aduioButton.style.transform == 'rotate(90deg)') {
                aduioButton.style.transform = 'rotate(0deg)';
                music.style.visibility = 'hidden';
                music.pause();
            } else {
                aduioButton.style.transform = 'rotate(90deg)';
                music.style.visibility = 'visible';

            }


        });
    });

    var startX = 0; //触摸开始时的位置
    var endX = 0; //触摸结束时的位置
    var startTime = 0; //触摸开始的时间
    var endTime = 0; //触摸结束的时间

    //获取触摸开始时的位置和时间
    video.addEventListener('touchstart', function (event) {
        startX = event.touches[0].pageX;
        startTime = new Date().getTime();
    }, false);

    //获取触摸过程中的实时位置
    video.addEventListener('touchmove', function (event) {
        endX = event.touches[0].pageX;
    }, false);

    //当触摸结束时，判断是否进行切换操作
    video.addEventListener('touchend', function (event) {
        var distance = endX - startX; //触摸移动的距离
        endTime = new Date().getTime(); //获取触摸结束的时间
        var duration = endTime - startTime; //触摸持续的时间
        var speed = Math.abs(distance) / duration; //触摸的速度

        if (distance > 5 && speed > 0.2) { //向右滑动的条件
            //执行向右滑动的操作
            window.location.href = "/street.html";
        } else if (distance < 5 && speed > 0.2) { //向左滑动的条件
            //执行向左滑动的操作
            window.location.href = "/barber.html";
        }
    }, false);
</script>

</html>